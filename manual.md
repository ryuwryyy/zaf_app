# ZAF（Odza）アプリ 運用マニュアル（非エンジニア向け）

このドキュメントは、エンジニアでない方がアプリのコンテンツを更新・運用する際の手順をまとめたものです。  
**コードやファイルを編集する作業は、テキストエディタ（メモ帳、VS Code、Cursor など）で該当ファイルを開き、記載の場所を変更してください。**  
不明な点は開発者に確認してください。

---

## 目次

1. [はじめに](#1-はじめに)
2. [ZAF商品の画像・テキストの変更](#2-zaf商品の画像テキストの変更)
3. [名言（今日の気づき）の追加・変更](#3-名言今日の気づきの追加変更)
4. [キャンペーン・プッシュ通知の設定](#4-キャンペーンプッシュ通知の設定)
5. [リマインダー通知の文言変更](#5-リマインダー通知の文言変更)
6. [アプリ内で保存されているデータ（編集の考え方）](#6-アプリ内で保存されているデータ編集の考え方)
7. [Firebase / Firestore について](#7-firebase--firestore-について)
8. [編集してはいけないファイル・項目](#8-編集してはいけないファイル項目)
9. [Excel 等で管理しているデータの連携](#9-excel-等で管理しているデータの連携)

---

## 1. はじめに

- アプリの**表示テキスト・画像・通知文言**は、プロジェクト内の**特定のファイル**を編集することで変更できます。
- **データの保存場所：** 現在、ユーザーの設定や履歴は**アプリ端末内（AsyncStorage）** に保存されています。**Firestore などのサーバーDBは現時点では使っていません**（後述）。
- 変更を反映するには、**アプリの再ビルド**または**開発サーバーでの再読み込み**が必要です。ファイルを保存しただけでは、すでにインストール済みのアプリには反映されません。

---

## 2. ZAF商品の画像・テキストの変更

ZAF商品は **SETTING（設定）** 画面の「ZAF PRODUCTS」に表示され、タップすると商品詳細画面が開きます。

### 2.1 商品のテキスト（タイトル・説明文）を変える

**編集するファイル：**  
`app/zaf-product.tsx`

**編集する場所：** ファイルの **15 行目付近** にある `PRODUCTS` というオブジェクトです。

```javascript
const PRODUCTS: Record<string, { title: string; description: string }> = {
  '1': { title: 'ZAF Product 1', description: '瞑想とマインドフルネスをサポートする商品です。…' },
  '2': { title: 'ZAF Product 2', description: '心地よい音や香りで、瞑想の環境を整えましょう。' },
  '3': { title: 'ZAF Product 3', description: '瞑想の記録や習慣づけをサポートするツールです。' },
  '4': { title: 'ZAF Product 4', description: 'より深い瞑想体験のためのアイテムをご紹介しています。' },
};
```

- **`title`** … 商品名（画面のタイトル）
- **`description`** … 商品の説明文（改行は `\n` で入れます）
- **`'1'` ～ `'4'`** … 商品ID（設定画面のカード順・詳細画面の `?id=1` などに対応）

**注意：**  
- 引用符 `'` や括弧 `{` `}` を消したり、カンマ `,` を忘れたりするとエラーになります。変更したら保存し、アプリが起動するか確認してください。
- 商品を増やしたり、ID を変えたりする場合は、設定画面の一覧部分（後述）の修正も必要です。その場合はエンジニアに依頼してください。

### 2.2 商品画像を変える

**現在の仕様：**  
- 設定画面の 4 つの商品カードも、商品詳細画面も、**同じ 1 枚の画像**を使っています。
- 画像ファイルの場所：**`assets/images/01.png`**

**手順：**

1. **新しい画像を用意する**  
   - 形式：PNG または JPG 推奨  
   - ファイル名を **`01.png`** にするか、既存の `01.png` を別名でバックアップしてから、新しい画像を `01.png` という名前で保存します。

2. **差し替える**  
   - プロジェクトフォルダ内の **`assets/images/01.png`** を、新しい画像で**上書き**します。  
   - ファイル名は **`01.png`** のままにしてください。

3. **反映**  
   - アプリを再ビルドするか、開発中なら画面を再読み込みすると、設定画面・商品詳細の両方で新しい画像が表示されます。

**商品ごとに別の画像にしたい場合：**  
現状のコードは 1 枚共通のため、商品ごとに画像を分けるにはコードの修正が必要です。エンジニアに「商品ID 1～4 でそれぞれ別画像を使いたい」と依頼してください。

### 2.3 設定画面の商品一覧で使う画像

**編集するファイル：**  
`app/(tabs)/settings.tsx`

**編集する場所：** 「ZAF PRODUCTS」のグリッド部分（**620 行目付近**）。  
ここでも `require('@/assets/images/01.png')` で 1 枚の画像を参照しています。  
画像を `01.png` で差し替えれば、一覧・詳細の両方に反映されます。商品ごとに画像を分ける場合は、ここもコード変更が必要です。

---

## 3. 名言（今日の気づき）の追加・変更

ホーム画面の **「今日の気づき」** に表示される名言を変更します。

**編集するファイル：**  
`app/(tabs)/index.tsx`

**編集する場所：** **318 行目付近** の「Today's quote / 今日の気づき」セクションです。

```javascript
<Text style={[styles.quoteText, { color: textMuted }]}>
  今あるものに満たされない者は{'\n'}
  これから欲しいものにも満たされない
</Text>
<View style={styles.quoteAttributionRow}>
  …
  <Text style={[styles.quoteAttribution, { color: textMuted }]}>
    ソクラテス(古代ギリシャの哲学者)
  </Text>
</View>
```

- **1 つ目の `<Text>...</Text>`** … 名言の本文  
  - 改行は **`{'\n'}`** で入れます。
- **「ソクラテス(…)」の `<Text>...</Text>`** … 出典・著者名

ここを書き換えて保存すると、表示が変わります。  
**複数の名言を日替わりで出したい場合**は、日付に応じて選ぶ処理をコードに追加する必要があります。その場合はエンジニアに依頼し、「名言リストと日付で選ぶ仕様」を相談してください。

---

## 4. キャンペーン・プッシュ通知の設定

アプリでは **Expo Push** を使ってプッシュ通知を送信します。  
Firestore は**通知の送信には使っておらず**、送信は **Expo のサーバー（API）** 経由で行います。

### 4.1 プッシュ通知を送る流れ（概要）

1. ユーザーがアプリを起動すると、端末ごとの **Expo Push トークン** が取得され、アプリ内に保存されます。
2. キャンペーンなどで通知を送りたいときは、**そのトークン** を使って、Expo の API に「この端末に通知を送って」とリクエストします。
3. 詳細は **`docs/push-notifications.md`**（英語）に記載があります。  
   - 送信例（curl）や、Expo のダッシュボードからの送信方法が書かれています。

### 4.2 非エンジニアがキャンペーン通知を送る場合

- **Expo のダッシュボード（Web）** から送る方法があれば、そこからタイトル・本文を入力して送信できます。  
  - 利用には Expo アカウントとプロジェクトへのアクセスが必要です。
- **送信用のツール（例：Excel からトークン一覧を読み、API を叩く小さなプログラム）** を別途用意する場合は、エンジニアに依頼してください。  
  - その際、「どのコレクション／カラムを触るか」は **Firestore ではなく、Expo Push の「送信先トークン一覧」と「送信API」** の話になります。

### 4.3 通知をタップしたときの画面

通知のペイロードに **`data.screen`** や **`data.url`** を入れておくと、タップ時に指定した画面を開けます。  
例：`"screen": "/(tabs)"` でタブ画面、`"screen": "/goal-detail"` で目標詳細画面。  
送信する JSON の形式は `docs/push-notifications.md` を参照してください。

---

## 5. リマインダー通知の文言変更

**リマインダー**は、ユーザーが設定画面で「時刻」を登録すると、その時刻に**端末でローカル通知**が鳴る機能です。  
通知の**タイトル**と**本文**は、ユーザーが設定画面で編集できる項目として保存されています。

### 5.1 アプリ内でのデフォルト文言

- **タイトル**のデフォルト：`ZAF リマインダー`
- **本文**のデフォルト：`瞑想の時間です。（{time}）`  
  - `{time}` は、そのリマインダーの時刻（例：20:00）に自動で置き換わります。

ユーザーは **SETTING（設定）** のリマインダー設定で、タイトル・本文を変更できます。  
**運用側で「全ユーザーのデフォルト」を変えたい**場合は、コードのデフォルト値を変更する必要があります。

### 5.2 デフォルト文言をコードで変更する場合

**編集するファイル：**  
- **`lib/reminder-notifications.ts`** … 定数 `REMINDER_NOTIFICATION_TITLE`、`REMINDER_NOTIFICATION_BODY`（本文テンプレート）
- **`lib/background.ts`** … バックグラウンドから送る通知のデフォルト本文テンプレート `DEFAULT_BODY_TEMPLATE`
- **`app/(tabs)/settings.tsx`** … 設定画面で「リマインダー通知に表示するタイトルと本文」の初期表示やプレースホルダー

上記の定数・プレースホルダーを書き換えると、**新しくリマインダーを設定したユーザー**向けのデフォルトが変わります。  
既存ユーザーは、すでに保存されているタイトル・本文が使われます。

---

## 6. アプリ内で保存されているデータ（編集の考え方）

ユーザーの設定や履歴は、**Firestore ではなく**、端末内の **AsyncStorage** に保存されています。  
キー名はすべて **`@zaf/`** で始まります。

### 6.1 主なキーと内容（参照用）

| キー（例） | 内容 |
|-----------|------|
| `@zaf/onboarding_completed` | オンボーディング完了フラグ |
| `@zaf/goal_days` | 目標日数（ミッション） |
| `@zaf/daily_meditation_target_minutes` | 1日の目標瞑想時間（分） |
| `@zaf/reminders` | リマインダー一覧（時刻・ON/OFF） |
| `@zaf/reminder_notification_title` | リマインダー通知のタイトル |
| `@zaf/reminder_notification_body` | リマインダー通知の本文（`{time}` 可） |
| `@zaf/display_name` | 表示名 |
| `@zaf/profile_icon` | プロフィールアイコン種別 |
| `@zaf/color_scheme` | テーマ（ライト/ダーク/システム） |
| `@zaf/sessions` | セッション履歴 |
| `@zaf/missions_achieved` | 達成したミッション数 |
| `@zaf/expo_push_token` | Expo プッシュ用トークン |

これらは**アプリの動作に直結**するため、**通常はアプリの画面からだけ変更**し、**直接編集しない**ことを推奨します。  
バックアップやデータ移行などで触る場合は、必ずエンジニアと相談してください。

---

## 7. Firebase / Firestore について

**現時点では、本アプリは Firestore（および Firebase の他のサービス）をコンテンツ・設定の保存先として使用していません。**

- **プッシュ通知** … Expo Push（Expo の API）を使用しています。  
  - Android 用に **Firebase（FCM）** の設定ファイル（`google-services.json` 等）は使っていますが、**通知の送信・配信は Expo 経由**です。
- **データ保存** … ユーザーごとの設定・履歴は **AsyncStorage（端末内）** です。

そのため、

- 「**このコレクション／このカラムを編集してください**」という **Firestore の運用手順は現状ありません**。
- 今後、**名言・商品情報・キャンペーン情報などを Firestore で管理**する場合は、  
  - **編集してよいコレクション／ドキュメント／フィールド**  
  - **絶対に編集・削除してはいけない項目**  
  を仕様に合わせて決め、その内容で別途マニュアルを追加することをおすすめします。

---

## 8. 編集してはいけないファイル・項目

以下は、**誤って変更するとアプリが動かなくなったり、データが壊れたりする**ため、非エンジニアの方は編集しないでください。

- **設定ファイル類**  
  - `app.json`、`package.json`、`eas.json`、`tsconfig.json` など  
  - ビルドやパッケージ名、依存ライブラリの設定が書かれています。
- **認証・鍵関連**  
  - `google-services.json`、`google-service-account-key.json` など  
  - 削除・中身の書き換えはしないでください。
- **ルーティング・レイアウトの中心**  
  - `app/_layout.tsx`、`app/(tabs)/_layout.tsx` など  
  - 画面構成や通知の初期設定が含まれます。
- **ストレージキー名**  
  - `lib/storage.ts` の `PREFIX`（`@zaf/`）や各キー名  
  - 変更すると、既存ユーザーのデータが読めなくなります。
- **Firebase / FCM の設定**  
  - 上記の `google-services.json` 等  
  - プッシュ通知が届かなくなる可能性があります。

**コンテンツの変更は、このマニュアルで案内している「ZAF商品」「今日の気づき」「リマインダー文言」などのファイル・箇所に限定する**と安全です。

---

## 9. Excel 等で管理しているデータの連携

「**非UIの機能を Excel で共有して運用したい**」という場合、現状のアプリは **Excel を直接読み込む機能はありません**。

- **コンテンツ（名言・商品テキストなど）** … 現状は **コード内の定数** または **画像ファイルの差し替え** で対応しています。  
  - Excel で一覧管理し、**その内容をコードや Firestore に反映する作業**は、手作業で行うか、エンジニアに「Excel → アプリ用データ」の変換スクリプトやツールの作成を依頼する形になります。
- **キャンペーン通知の送信先・送信日時** … 現状は **Expo Push のトークン** と **Expo の API（またはダッシュボード）** で送るため、**Excel で送信リストや日時を管理する**場合は、その Excel を読み込んで API を叩く**小さなツール**を別途作る必要があります。  
  - どの項目を Excel で持ち、どのタイミングで誰がツールを実行するかは、運用ルールとして決めたうえで、エンジニアに仕様を伝えてください。

---

## まとめ

| やりたいこと | 主に編集する場所 |
|-------------|------------------|
| ZAF商品のタイトル・説明 | `app/zaf-product.tsx` の `PRODUCTS` |
| ZAF商品の画像 | `assets/images/01.png` の差し替え |
| 今日の気づき（名言） | `app/(tabs)/index.tsx` の「今日の気づき」セクション |
| リマインダー通知のデフォルト文言 | `lib/reminder-notifications.ts`、`lib/background.ts`、設定画面のプレースホルダー |
| キャンペーン通知を送る | Expo Push API または Expo ダッシュボード（Firestore は未使用） |
| データの保存先の理解 | AsyncStorage（`@zaf/` キー）。Firestore は現状未使用 |

不明点や、ここに書いていない変更（例：画面の文言を一括で変える、多言語対応など）は、開発者に相談してください。
